if [ -f /etc/smoothsec.cfg ]; then
	. /etc/smoothsec.cfg
fi
. /etc/afpacket.cfg


if [ "$AF_SETUP" == "yes" ]; then
	if [ "$AF_ENGINE" == "suricata" ]; then
		update-rc.d suricata remove > /dev/null 2>&1

		cp /usr/local/smoothsec/confs/afpacket/interfaces.original /etc/network/interfaces
		cp /usr/local/smoothsec/confs/afpacket/suricata.yaml.original /etc/suricata/suricata.yaml
		cp /usr/local/smoothsec/confs/afpacket/suricata.original /etc/init.d/suricata
		cp /usr/local/smoothsec/confs/afpacket/sagan.conf.original /etc/sagan/sagan.conf
		cp /usr/local/smoothsec/confs/afpacket/sagan.original /etc/init.d/sagan
		#apt-get -y --purge remove linux-image-3.10-2-amd64 linux-headers-3.10-2-amd64
		mv /boot/*-3.10-2-* /usr/local/smoothsec/confs/afpacket/
		update-grub

		sed -i "s|AF_SETUP=yes|AF_SETUP=no|" /etc/afpacket.cfg
		#update-rc.d $ENGINE defaults > /dev/null 2>&1
	elif [ "$AF_ENGINE" == "snort" ]; then
		update-rc.d snort remove > /dev/null 2>&1

		cp /usr/local/smoothsec/confs/afpacket/interfaces.original /etc/network/interfaces
		cp /usr/local/smoothsec/confs/afpacket/sagan.conf.original /etc/sagan/sagan.conf
		cp /usr/local/smoothsec/confs/afpacket/sagan.original /etc/init.d/sagan
		cp /usr/local/smoothsec/confs/afpacket/snort.original /etc/init.d/snort

		sed -i "s|AF_SETUP=yes|AF_SETUP=no|" /etc/afpacket.cfg
		#update-rc.d $ENGINE defaults > /dev/null 2>&1
	fi	
	cp /usr/local/smoothsec/confs/afpacket/tunnel.original /etc/init.d/tunnel
	# restore the configure file
	cp /usr/local/smoothsec/confs/afpacket/afpacket.cfg /etc/	
fi

echo "Reboot the system ...."
